.TH ipsvd-instruct 5
.SH NAME
ipsvd-instruct \- format of the ipsvd(8) instructions directory
.SH DESCRIPTION
The internet protocol service daemons,
.BR ipsvd (8),
can be told to read and follow instructions from a directory on incoming
connections to the socket they listen on.
.P
For mostly static instructions or for performance reasons, it is possible to
compile the instructions from a directory into a constant database (cdb) with
.BR ipsvd-cdb (8)
for faster lookup, and to tell
.BR ipsvd (8)
to read the instructions from there.
.SH MATCHING
On each incoming connection, the
.BR ipsvd (8)
matches the client's IP address against files in the instructions directory.
For example, the IP address
.I a.b.c.d
is matched against the following files in the instructions directory, in
this order, first match wins:
.TP
1.
.I a.b.c.d
.TP
2.
.I a.b.c
.TP
3.
.I a.b
.TP
4.
.I a
.P
After successfully matching a client's IP address against the instructions
directory,
.BR ipsvd (8)
examines the file that matched the IP address, and acts accordingly:
.TP
1.
If the file doesn't have any of the user's access permissions set (chmod 0),
the connection is closed immediately.
.TP
2.
If the file has the user's execute permission set,
.BR ipsvd (8)
reads the contents of the file and runs
.I /bin/sh -c '<contents>'
instead of the default program
.I prog
given at the command line for this connection.
.TP
3.
If the file has the user's read permission set,
.BR ipsvd (8)
reads the contents of the file and interprets each line as an instruction
for this connection (see below).
.P
If the client's IP address doesn't match any file in the instructions
directory, the default action is taken (the program
.I prog
is run to handle the connection, unless the -n option is given).
.SH INSTRUCTIONS
If
.BR ipsvd (8)
is given instructions for an incoming connection, it reads the corresponding
file and interprets each line as follows.
The file may be empty, meaning that there is no special instruction.
.TP
1.
If the line starts with a plus (``+''), and the string following the plus
contains a ``='',
.BR ipsvd (8)
puts the string following the plus into the environment before starting
.IR prog
to handle the connection.
If the string following the plus doesn't contain a ``='',
.BR ipsvd (8)
prints a warning and discards this line.
.P
If
.BR ipsvd (8)
cannot interpret a line, it prints a warning, discards the line, and
continues with the next instruction if any.
.SH EXAMPLE INSTRUCTIONS
.TP
+MEMORY=20000
This instruction causes the environment variable ``MEMORY'' with the value
``20000'' to be availbale to the program
.I prog
that handles the connection.
.TP
+DEBUG=
This instruction adds the variable ``DEBUG'' with an empty value to the
environment.
.SH SEE ALSO
ipsvd(7),
ipsvd-cdb(8),
tcpsvd(8),
udpsvd(8)
.P
http://smarden.org/ipsvd/
.SH AUTHOR
Gerrit Pape <pape@smarden.org>
