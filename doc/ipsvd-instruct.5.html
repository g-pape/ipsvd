


<HTML>
<HEAD>
<TITLE>ipsvd-instruct(5) manual page</TITLE>
</HEAD>
<BODY bgcolor=white>
<a href="http://smarden.org/pape/">G. Pape</a><br><A HREF="index.html">ipsvd</A><hr><P>

<H2><A NAME="sect0">Name</A></H2>
ipsvd-instruct - format of the <I>ipsvd(8)</I> instructions directory 
<H2><A NAME="sect1">Description</A></H2>
The
internet protocol service daemons, <B><I>ipsvd</B>(7)</I>, can be told to read and follow
instructions from a directory on incoming connections to the socket they
listen on. <P>
For mostly static instructions or for performance reasons, it
is possible to compile the instructions from a directory into a constant
database (cdb) with <B><I>ipsvd-cdb</B>(8)</I> for faster lookup, and to tell <B><I>ipsvd</B>(7)</I>
to read the instructions from there. 
<H2><A NAME="sect2">Matching</A></H2>
On each incoming connection,
the <B><I>ipsvd</B>(7)</I> matches the client's IP address against files in the instructions
directory. For example, the IP address <I>a.b.c.d</I> which reverse resolves to <I>eric.burdon.smarden.org</I>
is matched against the following files in the instructions directory, in
this order, first match wins: 
<OL>
.<LI><I>a.b.c.d</I> </LI>.<LI><I>a.b.c</I> </LI>.<LI><I>a.b</I> </LI>.<LI><I>a</I> </LI>
</OL>
<P>
If the client's hostname has
been successfully looked up in DNS: 
<OL>
.<LI><I>eric.burdon.smarden.org</I> </LI>.<LI><I>burdon.smarden.org</I>
</LI>.<LI><I>smarden.org</I> </LI>.<LI><I>org</I> </LI>
</OL>
<P>
And finally the catchall file ``0'' (zero): 
<OL>
.<LI><I>0</I> </LI>
</OL>
<P>
After successfully
matching a client's IP address or hostname against the instructions directory,
<B><I>ipsvd</B>(7)</I> examines the file that matched the IP address or hostname, and
acts accordingly: 
<OL>
.<LI>If the file doesn't have any of the user's access permissions
set (chmod 0), the connection is closed immediately. </LI>.<LI>If the file has the
user's execute permission set, <B><I>ipsvd</B>(7)</I> reads the contents of the file and
runs <I>/bin/sh</I> -c '&lt;contents&gt;' instead of the default program <I>prog</I> given at the
command line for this connection. </LI>.<LI>If the file has the user's read permission
set, <B><I>ipsvd</B>(7)</I> reads the contents of the file and interprets each line as
an instruction for this connection (see below). </LI>
</OL>
<P>
If the client's IP address
or hostname doesn't match any file in the instructions directory, the default
action is taken (the program <I>prog</I> is run to handle the connection). 
<H2><A NAME="sect3">Instructions</A></H2>
If
<B><I>ipsvd</B>(7)</I> is given instructions for an incoming connection, it reads the
corresponding file and interprets each line as follows. The file may be
empty, meaning that there is no special instruction. 
<DL>

<DT><B>+</B><I>VAR=VALUE</I> </DT>
<DD>environment.
If the line starts with a plus (``+''), and the string following the plus contains
a ``='', <B><I>ipsvd</B>(7)</I> puts the string following the plus into the environment before
starting <I>prog</I> to handle the connection. If the string following the plus
doesn't contain a ``='', <B><I>ipsvd</B>(7)</I> makes sure that the environment variable with
the name string is not set. </DD>

<DT><B>C</B><I>num</I> </DT>
<DD>concurrency. If the line starts with a ``C'',
and is followed by a number, the per host concurrency limit for the IP
address that initiated the connection is set to this number. Only the first
concurrency instruction is considered. Not all <B><I>ipsvd</B>(7)</I>'s support per host
concurrency. </DD>
</DL>
<P>
If <B><I>ipsvd</B>(7)</I> cannot interpret a line, it prints a warning, discards
the line, and continues with the next instruction if any. 
<H2><A NAME="sect4">Example Instructions</A></H2>

<DL>

<DT>+MEMORY=20000
</DT>
<DD>This instruction causes the environment variable ``MEMORY'' with the value
``20000'' to be available to the program <I>prog</I> that handles the connection. </DD>

<DT>+DEBUG=
</DT>
<DD>This instruction adds the variable ``DEBUG'' with an empty value to the environment.
</DD>

<DT>+LOGNAME </DT>
<DD>This instructions makes sure that the environment variable ``LOGNAME''
is unset when running <I>prog</I>. </DD>

<DT>C16 </DT>
<DD>Set the per host concurrency to 16. A connection
will be closed silently if there are already 16 active connections from
this client's IP address. </DD>
</DL>

<H2><A NAME="sect5">See Also</A></H2>
<I>ipsvd(7)</I>, <I>ipsvd-cdb(8)</I>, <I>tcpsvd(8)</I>, <I>udpsvd(8)</I>
<P>
<I>http://smarden.org/ipsvd/</I> 
<H2><A NAME="sect6">Author</A></H2>
Gerrit Pape &lt;pape@smarden.org&gt; <P>

<HR><P>
<A NAME="toc"><B>Table of Contents</B></A><P>
<UL>
<LI><A NAME="toc0" HREF="#sect0">Name</A></LI>
<LI><A NAME="toc1" HREF="#sect1">Description</A></LI>
<LI><A NAME="toc2" HREF="#sect2">Matching</A></LI>
<LI><A NAME="toc3" HREF="#sect3">Instructions</A></LI>
<LI><A NAME="toc4" HREF="#sect4">Example Instructions</A></LI>
<LI><A NAME="toc5" HREF="#sect5">See Also</A></LI>
<LI><A NAME="toc6" HREF="#sect6">Author</A></LI>
</UL>
</BODY></HTML>
